@page "/"
@using _10xCards.Models
@using _10xCards.Services
@inject DecksApiClient DecksApiClient

<PageTitle>Home</PageTitle>

<h1>Decks</h1>

<p>Enter a valid Supabase access token to load your decks.</p>

<div class="mb-3">
    <label class="form-label" for="accessToken">Access token</label>
    <input id="accessToken" class="form-control" @bind="accessToken" />
</div>

<button class="btn btn-primary" @onclick="LoadDecksAsync">Load decks</button>

@if (!string.IsNullOrWhiteSpace(errorMessage))
{
    <div class="alert alert-danger mt-3">
        @errorMessage
    </div>
}

@if (decks is not null)
{
    <ul class="list-group mt-3">
        @foreach (var deck in decks)
        {
            <li class="list-group-item">
                <strong>@deck.Name</strong>
                <div class="text-muted">@deck.CreatedAt.ToString("u")</div>
            </li>
        }
    </ul>
}

@code {
    private string? accessToken;
    private IReadOnlyList<DeckDto>? decks;
    private string? errorMessage;

    private async Task LoadDecksAsync()
    {
        errorMessage = null;
        decks = null;

        if (string.IsNullOrWhiteSpace(accessToken))
        {
            errorMessage = "Access token is required to load decks.";
            return;
        }

        try
        {
            decks = await DecksApiClient.GetDecksAsync(accessToken);
        }
        catch (DecksApiException exception)
        {
            errorMessage = exception.Message;
        }
        catch (Exception exception)
        {
            errorMessage = $"Unexpected error: {exception.Message}";
        }
    }
}
